<!--
read everything in one big file (user-project-timestamp, code, cfog)
need to replace tabs in the code with \t, then find-replace in JS
also need graphviz (can do with python?)
file should be totally prepped in python?
user-project-timestamp.py

Sort by:
    problem
        user
            simplified CFG

-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Simplified Control Flow Graph visualizations</title>
<style type="text/css" media="screen">
    #editor { 
		margin-left: 0px;
		margin-top: 25px;
		width: 600px;
		height: 300px;
	}
</style>

<script src="js/viz.js" type="text/javascript" charset="utf-8"></script>
<script src="js/functions.js" type="text/javascript" charset="utf-8"></script>
<script src="js/ace/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="js/jquery/jquery.js" type="text/javascript"></script>
<script src="js/jstree/jstree.min.js" type="text/javascript"></script>
<script src="js/makemap.js" type="text/javascript"></script>

<link rel="stylesheet" href="js/jstree/themes/default/style.min.css" />
<link rel="stylesheet" href="css/style.css" />
</head>
<body>

        
<div id="jstree" class="divleft"> </div>

<div id="editor" class="divright"> </div>

<div id="graphviz"> graph goes here </div>

<script>
  //fs = require('fs');
  var tree = getFileFromServer("data/esubs.tsv", function(text) {
    if (text === null) {
      console.log("error reading file esubs.tsv");
    }
    else {
      var tree = makeJSTree(readSubs(text));
      $(function () {
        $('#jstree').jstree({ 
          'core' : {
            'data' : tree
          }
        });
      });
    }
  });
  console.log("Read JSTree");
  console.log("js tree: " + Object.size(tree));

</script>


    
<script>
function graphviz(text) {
    text=text.replace('\\n', '\n');
    var svg=Viz(text, "svg", "dot");
    var container = document.getElementById('graphviz');
    container.innerHTML=svg;
}
graphviz('digraph G {\n0 -> 1;\n0 -> 2;\n1 -> 3;\n1 -> 4;\n3 -> 3;\n3 -> 3;\n4 -> 5;\n5 -> 6;\n6 -> 7;\n6 -> 8;\n8 -> 9;\n8 -> 10;\n0 [label="FunctionDef"];\n3 [label="If"];\n6 [label="If"];\n10 [label="Return"];\n7 [label="Return"];\n9 [label="Return"];\n1 [label="For"];\n2 [label="Return"];\n5 [label="For"];\n4 [label="If"];\n8 [label="If"];\n}');

</script>

<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/twilight");
    editor.getSession().setMode("ace/mode/python");
    console.log("editor div set up");
    // TODO: read the .tsv file with a button
    getFileFromServer("2subs.tsv", function(text) {
        if (text === null) {
            console.log("error");
        }
        else {
            console.log("got it");
            console.log(text.length);
            tokens=text.split("\t");
            code=tokens[5].replace("\\n", "\n");
            editor.setValue(code);
            editor.setValue(text);
        }
    });

</script>
</body>
</html>	